# Video Generation Service

This service provides functionality to generate videos from text content using FFmpeg. It supports multiple slides, narration, and background music.

## Features

- Generate videos from text content with multiple slides
- Support for different video styles (Professional, Educational, Casual)
- Optional text-to-speech narration
- Background music support
- Progress tracking for long-running tasks
- Asynchronous processing

## Components

### 1. FFmpegVideoService

Core service that handles video generation using FFmpeg.

#### Key Methods:

- `generate_video()`: Generate a video from slides
- `_generate_slide_video()`: Generate a video for a single slide
- `_process_audio()`: Process audio files (background music, narration)
- `_generate_thumbnail()`: Generate a thumbnail from a video

### 2. VideoGenerationService

High-level service that coordinates video generation tasks.

#### Key Methods:

- `generate_video()`: Start a video generation task
- `_process_video_generation()`: Background task for video generation
- `_generate_slides()`: Convert script into slides
- `_generate_narration()`: Generate narration audio using TTS

## Usage

```python
from sqlalchemy import create_engine
from sqlalchemy.orm import sessionmaker
from app.services.video.service import VideoGenerationService
from app.schemas.video import VideoGenerationRequest, VideoStyle

# Initialize database session
db_engine = create_engine("sqlite:///./test.db")
SessionLocal = sessionmaker(autocommit=False, autoflush=False, bind=db_engine)
db = SessionLocal()

# Create service instance
service = VideoGenerationService(db)

# Create video generation request
request = VideoGenerationRequest(
    script="""# Welcome to NoteFusion AI
    
    This is a test video generated by NoteFusion AI.
    
    You can create beautiful videos from your notes automatically!""",
    style=VideoStyle.PROFESSIONAL,
    include_narration=True,
    duration_per_slide=5
)

# Start video generation
result = service.generate_video(
    request=request,
    user_id="user_123"
)

# Check task status
task_status = service.get_video_status(
    task_id=result["task_id"],
    user_id="user_123"
)
```

## Configuration

Environment variables can be used to configure the service:

- `VIDEO_OUTPUT_DIR`: Directory to save generated videos (default: `generated_videos`)
- `FFMPEG_PATH`: Path to FFmpeg executable (auto-detected if not specified)
- `TTS_PROVIDER`: Text-to-speech provider (default: `mock` for testing)

## Dependencies

- FFmpeg (must be installed and available in PATH)
- Python 3.8+
- Required Python packages (see `requirements.txt`)

## Testing

Run the test script to verify the video generation:

```bash
python -m scripts.test_video_gen
```

## Notes

- The service uses a task-based architecture for long-running video generation tasks
- Progress is tracked in the database and can be queried using the task ID
- Temporary files are automatically cleaned up after generation
