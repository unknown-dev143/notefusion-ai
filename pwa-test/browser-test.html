<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <meta name="description" content="Test PWA features and browser compatibility for NoteFusion AI">
    <script>
      // Check if browser supports theme-color meta tag
      const supportsThemeColor = !/firefox|fxios|opr/i.test(navigator.userAgent);
      if (supportsThemeColor) {
        // Add theme-color meta tags for supported browsers
        const lightTheme = document.createElement('meta');
        lightTheme.name = 'theme-color';
        lightTheme.content = '#1a73e8';
        lightTheme.media = '(prefers-color-scheme: light)';
        document.head.appendChild(lightTheme);

        const darkTheme = document.createElement('meta');
        darkTheme.name = 'theme-color';
        darkTheme.content = '#1a1b2e';
        darkTheme.media = '(prefers-color-scheme: dark)';
        document.head.appendChild(darkTheme);
      }
    </script>
    <link rel="apple-touch-icon" href="/icons/icon-192x192.png">
    <link rel="manifest" href="/manifest.json">
    <title>Browser Compatibility Test - NoteFusion AI</title>
    <style>
        :root {
            --primary-color: #1a73e8;
            --primary-hover: #1557b0;
            --text-color: #202124;
            --bg-color: #ffffff;
            --card-bg: #f8f9fa;
            --border-color: #dadce0;
        }
        
        @media (prefers-color-scheme: dark) {
            :root {
                --text-color: #e8eaed;
                --bg-color: #202124;
                --card-bg: #2d2e30;
                --border-color: #5f6368;
            }
        }
        
        body {
            font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
            line-height: 1.6;
            color: var(--text-color);
            background-color: var(--bg-color);
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }
        
        h1, h2 {
            color: var(--primary-color);
        }
        
        .test-section {
            background: var(--card-bg);
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            border: 1px solid var(--border-color);
        }
        
        .test-result {
            margin: 10px 0;
            padding: 10px;
            border-radius: 4px;
            background-color: rgba(0, 0, 0, 0.05);
        }
        
        .pass {
            color: #0f9d58;
        }
        
        .fail {
            color: #db4437;
        }
        
        button {
            background-color: var(--primary-color);
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            margin-top: 10px;
        }
        
        button:disabled {
            background-color: #bdc1c6;
            cursor: not-allowed;
        }
        
        button:not(:disabled):hover {
            background-color: var(--primary-hover);
        }
        
        #summary {
            font-weight: bold;
            margin: 20px 0;
            padding: 15px;
            border-radius: 8px;
            background-color: #e8f0fe;
            border-left: 4px solid var(--primary-color);
        }
        
        @media (max-width: 600px) {
            body {
                padding: 10px;
            }
            
            .test-section {
                padding: 15px;
            }
        }
    </style>
</head>
<body>
<h1>Browser Compatibility Test</h1>
    <p>This page tests various PWA features across different browsers.</p>
    
    <div class="test-section">
        <h2>1. Service Worker Support</h2>
        <div id="sw-support" class="test-result">Testing...</div>
        <div id="sw-status" class="test-result"></div>
    </div>
    
    <div class="test-section">
        <h2>2. Cache API Support</h2>
        <div id="cache-support" class="test-result">Testing...</div>
    </div>
    
    <div class="test-section">
        <h2>3. Push Notifications</h2>
        <div id="push-support" class="test-result">Testing...</div>
        <button id="test-push" disabled>Test Push Permission</button>
    </div>
    
    <div class="test-section">
        <h2>4. Background Sync</h2>
        <div id="sync-support" class="test-result">Testing...</div>
    </div>
    
    <div class="test-section">
        <h2>5. IndexedDB Support</h2>
        <div id="indexeddb-support" class="test-result">Testing...</div>
    </div>
    
    <div class="test-section">
        <h2>6. Web App Manifest</h2>
        <div id="manifest-support" class="test-result">Testing...</div>
    </div>
    
    <div class="test-section">
        <h2>7. Install Prompt</h2>
        <div id="install-support" class="test-result">Testing...</div>
        <button id="install-btn" disabled>Install App</button>
    </div>
    
    <div class="test-section">
        <h2>8. Browser Support Matrix</h2>
        <div class="browser-support">
            <div class="browser">
                <div>Chrome</div>
                <div class="supported">✓ Supported</div>
            </div>
            <div class="browser">
                <div>Firefox</div>
                <div class="supported">✓ Supported</div>
            </div>
            <div class="browser">
                <div>Edge</div>
                <div class="supported">✓ Supported</div>
            </div>
            <div class="browser">
                <div>Safari</div>
                <div class="partial">⚠️ Partial</div>
            </div>
            <div class="browser">
                <div>iOS Safari</div>
                <div class="partial">⚠️ Partial</div>
            </div>
        </div>
    </div>
    
    <div class="test-section">
        <h2>Test Results</h2>
        <div id="test-summary">Running tests...</div>
        <button id="run-tests">Run Tests Again</button>
    </div>

    <script>
        // DOM Elements
        const testResults = {
            serviceWorker: { supported: false, message: '' },
            cache: { supported: false, message: '' },
            push: { supported: false, message: '' },
            sync: { supported: false, message: '' },
            indexedDB: { supported: false, message: '' },
            manifest: { supported: false, message: '' },
            install: { supported: false, message: '' }
        };

        // Test Service Worker support
        function testServiceWorker() {
            const result = document.getElementById('sw-support');
            const status = document.getElementById('sw-status');
            
            if ('serviceWorker' in navigator) {
                testResults.serviceWorker.supported = true;
                testResults.serviceWorker.message = 'Service Worker API is supported';
                result.innerHTML = `<span class="success">✓ ${testResults.serviceWorker.message}</span>`;
                
                // Test registration
                navigator.serviceWorker.register('test-sw-new.js')
                    .then(registration => {
                        status.innerHTML = `<span class="success">✓ Service Worker registered successfully</span>`;
                        return registration.update();
                    })
                    .catch(error => {
                        status.innerHTML = `<span class="error">✗ Service Worker registration failed: ${error.message}</span>`;
                    });
            } else {
                testResults.serviceWorker.message = 'Service Worker API is not supported';
                result.innerHTML = `<span class="error">✗ ${testResults.serviceWorker.message}</span>`;
            }
        }

        // Test Cache API support
        function testCacheAPI() {
            const result = document.getElementById('cache-support');
            
            if ('caches' in window) {
                testResults.cache.supported = true;
                testResults.cache.message = 'Cache API is supported';
                result.innerHTML = `<span class="success">✓ ${testResults.cache.message}</span>`;
            } else {
                testResults.cache.message = 'Cache API is not supported';
                result.innerHTML = `<span class="error">✗ ${testResults.cache.message}</span>`;
            }
        }

        // Test Push API support
        function testPushAPI() {
            const result = document.getElementById('push-support');
            const testBtn = document.getElementById('test-push');
            
            if ('PushManager' in window) {
                testResults.push.supported = true;
                testResults.push.message = 'Push API is supported';
                result.innerHTML = `<span class="success">✓ ${testResults.push.message}</span>`;
                testBtn.disabled = false;
                
                testBtn.addEventListener('click', () => {
                    Notification.requestPermission().then(permission => {
                        alert(`Push permission: ${permission}`);
                    });
                });
            } else {
                testResults.push.message = 'Push API is not supported';
                result.innerHTML = `<span class="warning">⚠️ ${testResults.push.message}</span>`;
            }
        }

        // Test Background Sync support
        function testBackgroundSync() {
            const result = document.getElementById('sync-support');
            
            if ('serviceWorker' in navigator && 'SyncManager' in window) {
                testResults.sync.supported = true;
                testResults.sync.message = 'Background Sync is supported';
                result.innerHTML = `<span class="success">✓ ${testResults.sync.message}</span>`;
            } else {
                testResults.sync.message = 'Background Sync is not supported';
                result.innerHTML = `<span class="warning">⚠️ ${testResults.sync.message}</span>`;
            }
        }

        // Test IndexedDB support
        function testIndexedDB() {
            const result = document.getElementById('indexeddb-support');
            
            if ('indexedDB' in window) {
                testResults.indexedDB.supported = true;
                testResults.indexedDB.message = 'IndexedDB is supported';
                result.innerHTML = `<span class="success">✓ ${testResults.indexedDB.message}</span>`;
            } else {
                testResults.indexedDB.message = 'IndexedDB is not supported';
                result.innerHTML = `<span class="warning">⚠️ ${testResults.indexedDB.message}</span>`;
            }
        }

        // Test Web App Manifest support
        function testManifest() {
            const result = document.getElementById('manifest-support');
            const link = document.querySelector('link[rel="manifest"]');
            
            if (link) {
                testResults.manifest.supported = true;
                testResults.manifest.message = 'Web App Manifest is supported';
                result.innerHTML = `<span class="success">✓ ${testResults.manifest.message}</span>`;
            } else {
                testResults.manifest.message = 'Web App Manifest not found';
                result.innerHTML = `<span class="warning">⚠️ ${testResults.manifest.message}</span>`;
            }
        }

        // Test Install Prompt
        function testInstallPrompt() {
            const result = document.getElementById('install-support');
            const installBtn = document.getElementById('install-btn');
            let deferredPrompt;
            
            window.addEventListener('beforeinstallprompt', (e) => {
                e.preventDefault();
                deferredPrompt = e;
                testResults.install.supported = true;
                testResults.install.message = 'Install prompt is supported';
                result.innerHTML = `<span class="success">✓ ${testResults.install.message}</span>`;
                installBtn.disabled = false;
                
                installBtn.addEventListener('click', () => {
                    deferredPrompt.prompt();
                    deferredPrompt.userChoice.then((choiceResult) => {
                        if (choiceResult.outcome === 'accepted') {
                            console.log('User accepted the install prompt');
                        }
                        deferredPrompt = null;
                    });
                });
            });
            
            // If the event doesn't fire, the feature isn't supported
            setTimeout(() => {
                if (!testResults.install.supported) {
                    testResults.install.message = 'Install prompt is not supported';
                    result.innerHTML = `<span class="warning">⚠️ ${testResults.install.message}</span>`;
                }
            }, 1000);
        }

        // Update test summary
        function updateSummary() {
            const summary = document.getElementById('test-summary');
            const passed = Object.values(testResults).filter(test => test.supported).length;
            const total = Object.keys(testResults).length;
            
            summary.innerHTML = `
                <h3>Test Results: ${passed} of ${total} tests passed</h3>
                <ul>
                    ${Object.entries(testResults).map(([key, value]) => 
                        `<li>${key}: ${value.supported ? '✓' : '✗'} ${value.message}</li>`
                    ).join('')}
                </ul>
                <p>Your browser: <strong>${navigator.userAgent}</strong></p>
            `;
        }

        // Run all tests
        function runAllTests() {
            testServiceWorker();
            testCacheAPI();
            testPushAPI();
            testBackgroundSync();
            testIndexedDB();
            testManifest();
            testInstallPrompt();
            
            // Update summary after a short delay to allow all tests to complete
            setTimeout(updateSummary, 1000);
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', runAllTests);
        document.getElementById('run-tests').addEventListener('click', runAllTests);
    </script>
</body>
</html>